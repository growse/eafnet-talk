<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Self-hosting On The Internet</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/growse.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h1>Self-hosting On The Internet</h1>
            <h2>The Internet Protocol,</h2>
            <h2>BGP,</h2>
            <h2>The Law,</h2>
            <h2>and YOU!</h2>
            <footer>Andrew Rowson, June 16th 2023</footer>
            <aside class="notes">
                Introduction. My name is etc. Full-time opinion-haver, full-time parent, part-time tinkerer,
                Going to talk about a silly idea I had a while back, which was to try and work out what it would take to
                self-host something on the internet, and maybe try and use my own IP address. You can already buy and
                "own" a domain name, so why can't you buy and "own" some IP addresses?
            </aside>
        </section>
        <section>
            <div class="r-fit-text">The Internet Protocol (IP)</div>
            <aside class="notes">So we're going to take a quick refresher through IP. What is it? It's essentially a
                numbering scheme for nodes in a network. A network is a collection of things that are connected together
                somehow, and the idea is that you give every node a unique number, or address. A bit like postal
                addresses, if you want to identify a node so that you can maybe send things to it, you can refer to it
                by its address.

                So what does an IP address look like?
            </aside>
        </section>
        <section>1
            <aside class="notes">Well, this is an address. It's the number "1".
            </aside>
        </section>
        <section>
            42541014265448851428341158021258918306
            <aside class="notes">
                <p>This is another address. It's quite a large number.</p>

                <p>So we have a very simple scheme here. Now, because we're dealing with computers, it's handy to have
                    these numbers be fixed-width, essentially meaning that we use the same amount of data to represent
                    each number. Computers are not very good at dealing with bits of data that can be arbitrary size -
                    if you can guarantee that a piece of data can fit within a range, things become a lot more
                    efficient to handle. So a while back, we decided that the IP address should be a 128-bit number.</p>
                <p>This gives us a lot of numbers to use. How many?</p>

            </aside>
        </section>
        <section>
            3.4 x 10<sup>38</sup>
            <aside class="notes">
                <p>This many. This is a lot. 340 trillion trillion trillion.</p>
                <p>The scale of big numbers are hard to grasp, so by point of comparison, this is enough addresses to
                    give an address to every atom on the surface of the earth, and still have about 99% of the address
                    space unused. We could give 4x 10<sup>15</sup> to every star in the observable universe. And each
                    address fits in 16 bytes.</p>
                <p>Now a big flat list of numbers is not very practical, so we like to think of the address space in a
                    hierarchy, a bit like the postal address service. That uses a hierarchy of Country, County, Town,
                    Street and number to uniquely identify an address. So what does this look like for IP?</p>
            </aside>
        </section>
        <section>2001:19f0:7400:8287:5400:04ff:fe29:1f39
            <aside class="notes"><p>So we take our 16 byte number, and chop it up into 8 groups of 2 bytes. We then
                represent each byte in hexadecimal rather than decimal (because that means we only need 2 characters per
                byte, 00-ff). We separate each group with a colon, and we end up at this.</p>
                <p>This is the same address as the address I showed you before. What does the address of "1" look
                    like?</p>
            </aside>
        </section>
        <section>0000:0000:0000:0000:0000:0000:0000:0000:0001
            <aside class="notes">This is "1". But it's a bit clumsy, so we'll strip leading zeros off groups and
                collapse adjacent groups of all zeros to get this
            </aside>
        </section>
        <section>::1
            <aside class="notes">Much better. This is actually a special address in our scheme, does anyone know what
                this address represents?
            </aside>
        </section>
        <section>
            2001:678:b0c::/48
            <aside class="notes"><p>A final point on addressing, we need a way to refer to a block of adjacent
                addresses. So we use this notation to represent a group of addresses, also called a subnet.</p>
                <p>This notation basically means "All the addresses for which the left-most 48-bits are 2001:678:b0c".
                    48-bites is 3 groups of 16, so basically any address for which the 3 left-most groups are these is
                    in this subnet.

                    Bigger the subnet mask, the *smaller* (fewer addresses) the subnet.
                </p></aside>
        </section>
        <section>
            Internet Assigned Numbers Authority (IANA)
            <aside class="notes"><p>So let's talk about ownership. Who owns and decides who gets to control a subnet, or
                group of addresses?</p>
                <p>Well, that's IANA. They "own" all the addresses. Much like how ICANN "own" all the domain names.</p>
                <p>Now, IANA delegates control down to different geographical regions, so for the purposes of use, we
                    care about RIPE</p></aside>
        </section>
        <section>
            Réseaux IP Européens (RIPE)
            <aside class="notes"><p>RIPE is the European Regional Internet Registry (RIR). Obviously, being European,
                it's got a French name.</p>
                <p>So, if you want to get an IP subnet assigned to you, you just go to RIPE and ask for one, right?</p>
                <p>Well, yes. Except you have to become a member first. And that involves paying them quite a lot of
                    money, every year. Thankfully, there's a useful workaround where if you can find an organisation who
                    is already a member, you can ask them to sponsor you and get an allocation that way. They might
                    charge you a small fee to cover their costs, but it's much much cheaper.</p>
                <p>Usefully, my ISP is a RIPE member who's happy to sponsor requests for addresses.</p>
                <p>Now, when you get resources allocated, it's generally a bad idea to get them allocated to an
                    individual. This is because people are messy - they lose interest, die, etc. and so you can end up
                    with a bunch of resources allocated to legal entities who are no longer interested or able to manage
                    them. So even if they're not used, it's difficult to reclaim. The general advice is to create a
                    legal entity to allocate the network to, and then ownership of that entity can be much more easily
                    transferred around. So, let's go talk to the government!</p></aside>
        </section>
        <section>
            Companies House
            <aside class="notes" data-markdown>
                * In this country, setting up a company is remarkably cheap and straightforward.
                * You fill out a form, pay a little bit, and you have a company!
            </aside>
        </section>
        <section>
            <img width="100%" src="img/exploits_of_a_mom.png"/>
            <aside class="notes" data-markdown>
                * There's a long & rich tradition amongst computery people to try and poke systems to see what happens
                * This XKCD cartoon is probably the best-known illustration of this.
            </aside>
        </section>
        <section>
            <img src="img/drop-table-students-companies-house.png"/>
            <aside class="notes" data-markdown>
                * this company actually existed!
                * Loads more on the companies house website
                * So what can a name be?
                * max length of 130ish chars
                1. you've got to end with Ltd or Limited (or regional equivs)
                1. You can't use certain reserved words like "Royal" and "Chartered"
                1. Can't be "offensive"
                * Ultimately made an application for this
            </aside>
        </section>
        <section>
            <p style="font-size: 1vw">
                00011011010110110011101100110101001110110011001100110101011011010100010001101111011011100010011101110100001000000101000001100001011011100110100101100011
                Ltd</p>
            <aside class="notes" data-markdown>
                * Lots of waiting
                * Shouldn't normally take this long
                * After a week, got a call from someone wanting to know what it meant
                * Two months after tha, I get an email
            </aside>
        </section>
        <section>
            <img width="100%" src="img/companies-house-rejected.png"/>
            <aside class="notes"><p>(Read the email)</p>
                <p>So yes, I tried to be clever and register the binary representation of some ANSI escape characters (I
                    think bold magenta and flashing) followed by the text "Don't Panic". And the government weren't
                    having any of it, although I find their reasoning somewhat specious. Who's going to "execute" a
                    company name?</p>
                <p>Anyhow, I picked a more benign name and admitted defeat.</p></aside>
        </section>
        <section>
            <img width="100%" src="img/economic-crime-and-corporate-transparency-bill.png"/>
            <aside class="notes" data-markdown>
                * A little while later, discovered a new bill had been proposed by the Home Office
                * The Economic Crime and Corporate Transparency Bill.
                * Let's look at clause 10
            </aside>
        </section>
        <section>
            <img width="100%" src="img/economic-crime-and-corporate-transparency-bill-clause-10.png"/>
            <aside class="notes" data-markdown>
                * (read the clause)
                * Did I annoy the government? Timing is coincidental
                * This isn't law yet, on its way to 3rd reading in the Lords.
                * This is your tax money at work!
            </aside>
        </section>
        <section>
            <img width="80%" src="img/ripe-db.png"/>
            <aside class="notes" data-markdown>
                * Got everything sorted out, ISP did all the work with RIPE
                * There's my subnet! 2001:678:b0c::/48
                * I get a 48, because that's the smallest size you can advertise
                * Vanity handle
                * Now that I own an subnet, I need to tell the internet where to send packets for my addresses.
            </aside>
        </section>
        <section>
            What is the internet?
            <aside class="notes" data-markdown>
                * Bunch of routers connected together that know how to route IP packets to a destination
            </aside>
        </section>
        <section>
            What is a router?
            <aside class="notes" data-markdown>
                * What is a router? Device that receives packets and works out where to send them. List of routes in a
                routing table
                * Packets have a destination address, router matches to a subnet it knows how to route, sends it to that
                destination
                * The internet is basically lots of routers linked together.
                * You probably have one in your house
                * Let's see an example
            </aside>
        </section>
        <section><pre><code class="r-stretch language-shell" data-trim data-noescape>$ traceroute -6 www.google.com
traceroute to www.google.com (2a00:1450:4009:81f::2004), 30 hops max, 80 byte packets
1  2001:8b0:c8f:e8b0::1 (2001:8b0:c8f:e8b0::1)  0.405 ms  0.436 ms  0.695 ms
2  x.witless.thn.aa.net.uk (2001:8b0:0:53::133)  7.590 ms  7.580 ms  7.645 ms
3  o.aimless.tch.aa.net.uk (2001:8b0:0:53::105)  7.685 ms  7.958 ms  7.898 ms
4  2001:4860:1:1::1592 (2001:4860:1:1::1592)  8.058 ms  8.050 ms  8.104 ms
5  2001:4860:0:1100::1 (2001:4860:0:1100::1)  7.983 ms  7.908 ms 2001:4860::12:0:b229 (2001:4860::12:0:b229)  8.865 ms
6  2001:4860:0:1::54cf (2001:4860:0:1::54cf)  8.152 ms 2001:4860:0:1::54d1 (2001:4860:0:1::54d1)  7.416 ms 2001:4860:0:1::54cf (2001:4860:0:1::54cf)  7.742 ms
7  lhr25s33-in-x04.1e100.net (2a00:1450:4009:81f::2004)  7.788 ms  7.265 ms  7.395 ms</code></pre>
            <aside class="notes" data-markdown>
                * Example using traceroute
                * How do routers get their routing tables?
            </aside>
        </section>
        <section>
            Border Gateway Protocol
            <aside class="notes" data-markdown>
                * BGP!
                * Old protocol, basically used for routers to advertise routes to other routers.
                * Routers have many routes, fun features like metrics, loop detection
                * Constant flux and chatter
                * Source of many hilarious outages (Facebook, tiny ISP deciding to route all of youtube through itself
                etc.)
            </aside>
        </section>
        <section>
            AS204946
            <aside class="notes" data-markdown>
                * BGP uses concept of Autonomous system
                * Want to advertise routes? Need an AS.
                * Got mine from RIPE along with my subnet.
                * About 31.5k AS's active, of which 20k are only publishing 1 prefix
                * To advertise, I need to find a router that'll accept a BGP advert.
                * Could maybe use my home internet connection
            </aside>
        </section>
        <section>
            <img src="img/vultr.png"/>
            <aside class="notes" data-markdown>
                * Actually easier to find a friendly hosting company
                * Vultr have lots of locations, and are cheap
            </aside>
        </section>
        <section>
            Linux + gobgpd
            <aside class="notes" data-markdown>
                * Spin up a linux VM
                * Install a BGP daemon (BIRD / Quagga are old, newer ones are easier)
                * Get the details from Vultr about where to BGP peer with
            </aside>
        </section>
        <section><pre><code class="r-stretch language-shell" data-line-numbers="4,6">$ ip addr show dev enp1s0
2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq state UP group default qlen 1000
    link/ether 56:00:04:29:1f:39 brd ff:ff:ff:ff:ff:ff
    inet6 2001:19f0:7400:8287:5400:4ff:fe29:1f39/64 scope global dynamic mngtmpaddr noprefixroute
       valid_lft 2591722sec preferred_lft 604522sec
    inet6 2001:678:b0c:0:68:74:74:70/48 scope global deprecated
       valid_lft forever preferred_lft 0sec
    inet6 fe80::5400:4ff:fe29:1f39/64 scope link
       valid_lft forever preferred_lft forever</code></pre>
            <aside class="notes" data-markdown>
                * Host has its own IP address
                * I've added the address from my block for a service I want to run.
            </aside>
        </section>
        <section>
            <pre><code data-trim data-noescape data-line-numbers="3-4" class="language-shell">$ ip -6 route
::1 dev lo proto kernel metric 256 pref medium
2001:678:b0c::/48 dev enp1s0 proto kernel metric 256 pref medium
2001:19f0:7400:8287::/64 dev enp1s0 proto ra metric 1024 expires 2591571sec pref medium
fe80::/64 dev enp1s0 proto kernel metric 256 pref medium
default via fe80::fc00:4ff:fe29:1f39 dev enp1s0 proto ra metric 1024 expires 1371sec mtu 1500 pref medium</code></pre>
            <aside class="notes" data-markdown>
                * Routing table from the linux machine.
                * Note that it knows how to route
            </aside>
        </section>
        <section><pre><code class="language-shell">$ gobgp global rib -a ipv6
   Network                  Next Hop             AS_PATH              Age        Attrs
*> ::/0                     2001:19f0:ffff::1    64515                16:13:23   [{Origin: i} {Med: 0}]
*> 2001:678:b0c::/48        ::                                        00:10:10   [{Origin: i} {Med: 0}]</code></pre>
            <aside class="notes" data-markdown>
                * Routing Information Base (RIB) of the linux VM.
                * Received a default route from Vultr
                * Also the RIB knows about a subnet from the local routing table
            </aside>
        </section>
        <section><pre><code class="language-shell">$ gobgp ne 2001:19f0:ffff::1 adj-out
ID  Network                  Next Hop                               AS_PATH              Attrs
1   2001:678:b0c::/48        2001:19f0:7400:8287:5400:4ff:fe29:1f39 204946               [{Origin: i} {Med: 0}]</code></pre>
            <aside class="notes" data-markdown>
                * This is what it's publishing to Vultr
                * Shows Next hop as self, and AS_PATH as me!
            </aside>
        </section>
        <section>
            Does it work?
            <aside class="notes" data-markdown>
                * Let's try and do a traceroute
            </aside>
        </section>
        <section>
            <pre><code class="r-stretch language-shell" style="font-size: 0.7em; line-height: 1em;">$ traceroute 2001:678:b0c:0:68:74:74:70
traceroute to 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70), 30 hops max, 80 byte packets
 1  2001:8b0:c8f:e8b0::1 (2001:8b0:c8f:e8b0::1)  1.879 ms  1.986 ms  2.311 ms
 2  x.witless.thn.aa.net.uk (2001:8b0:0:53::133)  8.994 ms  8.558 ms  9.225 ms
 3  k-aimless.thn.aa.net.uk (2001:8b0:0:53::101)  9.164 ms  9.101 ms  9.036 ms
 4  ns2.choopa.com (2001:7f8:4::4ff9:1)  9.758 ms  9.693 ms  9.632 ms
 5  ethernetae1-sr2.lon3.constant.com (2001:19f0:fc00::a45:34a)  9.571 ms ethernetae7-sr1.lon3.constant.com (2001:19f0:fc00::a45:346)  9.508 ms ethernetae1-sr2.lon3.constant.com (2001:19f0:fc00::a45:34a)  9.796 ms
 6  vl534-ds1-m2-r52b3-a.lon3.constant.com (2001:19f0:fc00::a45:292)  8.954 ms  8.175 ms vl535-ds1-m2-r52b3-b.lon3.constant.com (2001:19f0:fc00::a45:29a)  8.713 ms
 7  * * *
 8  2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70)  9.032 ms  8.972 ms  8.915 ms</code></pre>
            <aside class="notes" data-markdown>
                * It works!
                * Can follow the path from my internet connection to Vultr
                * How responsive is it?
            </aside>
        </section>
        <section>
            <pre><code style="font-size: 0.7em; line-height: 1em;" class="r-stretch" data-trim>64 bytes from 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70): icmp_seq=11 ttl=56 time=8.62 ms
64 bytes from 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70): icmp_seq=12 ttl=56 time=8.79 ms
64 bytes from 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70): icmp_seq=13 ttl=56 time=8.48 ms
64 bytes from 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70): icmp_seq=14 ttl=56 time=7.53 ms
64 bytes from 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70): icmp_seq=15 ttl=56 time=8.04 ms
From k-aimless.thn.aa.net.uk (2001:8b0:0:53::101) icmp_seq=16 Destination unreachable: No route
From 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70) icmp_seq=17 Destination unreachable: No route
From be2540.ccr42.lon13.atlas.cogentco.com (2001:550:0:1000::8275:365) icmp_seq=18 Time exceeded: Hop limit
From be2540.rcr21.b015589-1.lon13.atlas.cogentco.com (2001:550:0:1000::8275:366) icmp_seq=19 Destination unreachable: No route
From lag-19.ear3.Amsterdam1.Level3.net (2001:1900:5:3::179) icmp_seq=21 Time exceeded: Hop limit
64 bytes from 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70): icmp_seq=33 ttl=56 time=8.85 ms
64 bytes from 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70): icmp_seq=34 ttl=56 time=8.77 ms
            </code></pre>
            <aside class="notes" data-markdown>
                * Pretty amazing
                * Trying different routes when it goes down
                * Let's put a webserver up there for tasty content
            </aside>
        </section>
        <section>
            <img width="100%" src="img/eafnosupport.co.uk.img"/>
            <aside class="notes" data-markdown>
                * We're done. Self-hosted content on our own IP that we can take to different providers as we like
            </aside>
        </section>
        <section>
            But wait!
            <aside class="notes" data-markdown>
                * Hang on a minute, what there are more than place a destination is published?
                * Let's find out
                * Spun up another VM in chicago, configured it the same way.
                * Turned off London, let's traceroute
            </aside>
        </section>
        <section>
            <pre><code style="font-size: 0.7em; line-height: 1em;" class="r-stretch">$ traceroute 2001:678:b0c:0:68:74:74:70
traceroute to 2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70), 30 hops max, 80 byte packets
 1  2001:8b0:c8f:e8b0::1 (2001:8b0:c8f:e8b0::1)  1.530 ms  2.160 ms  2.476 ms
 2  x.witless.thn.aa.net.uk (2001:8b0:0:53::133)  8.316 ms  8.413 ms  8.731 ms
 3  ITAF.bar2.Brussels1.Level3.net (2001:1900:5:2:2::33ce)  8.671 ms  8.615 ms  8.557 ms
 4  * * *
 5  lo-0-v6.ear4.Chicago2.Level3.net (2001:1900::3:1af)  98.397 ms  98.952 ms  98.615 ms
 6  CHOOPA-LLC.ear4.Chicago2.Level3.net (2001:1900:2100::40ce)  104.251 ms  97.165 ms  99.711 ms
 7  vl838-ds1-u2-dl109-a.chi2.constant.com (2001:19f0:fc00::a43:152)  96.065 ms ethernetae6-er1.chi2.constant.com (2001:19f0:fc00::a43:8a)  98.804 ms  99.353 ms
 8  vl578-ds1-m2-it102-a.chi2.constant.com (2001:19f0:fc00::a43:222)  99.288 ms vl579-ds1-m2-it102-b.chi2.constant.com (2001:19f0:fc00::a43:22a)  99.224 ms vl578-ds1-m2-it102-a.chi2.constant.com (2001:19f0:fc00::a43:222)  95.312 ms
 9  * * *
10  2001:678:b0c:0:68:74:74:70 (2001:678:b0c:0:68:74:74:70)  96.446 ms  95.966 ms  95.512 ms</code></pre>
        </section>
        <section>
            <img width="100%" src="img/eafnosupport-us.co.uk.png" />
            <aside class="notes" data-markdown>
                * Now web request hits the us server
            </aside>
        </section>
        <section>
            Anycasting
            <aside class="notes" data-markdown>
                * Having multiple up is called Anycasting
                * common technique of CDNs to optimize content delivery
                * Routing rules means that clients will hit their "closest" endpoint
                * Also, good resilience
                * Gotchas include tying service availability to route publishing
            </aside>
        </section>
        <section>
            <img src="img/anycast-traceroute.png" />
            <aside class="notes" data-markdown>
                * Just to prove it works
            </aside>
        </section>
        <section>
            ?
        </section>
    </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
    });
</script>
</body>
</html>
